<?xml version="1.0"?>
<!--
################################################################################
# ElasticSearch-0.92.2-enabler-gridlib
#
# ElasticSearch Enabler Definition
#
# Common Variables (Change as Desired)
#
# ES_DATA_DIR - path where the data files are located; 
#				NOTE: for persistence across engine hosts, it is recommended you
#               specify a network-mounted directory for this variable.
#               Changing this might also affect other variables (e.g, CAPTURE_INCLUDES)              
#
# HTTP_PORT - port where this elasticsearch node listens for connections
# ES_CONF_DIR - path where the conf files are located;
#				NOTE: for persistence across engine hosts, it is recommended you
#               specify a network-mounted directory for this variable.
# ES_LOG_DIR - path where the logs files are located;
#				NOTE: for persistence across engine hosts, it is recommended you
#               specify a network-mounted directory for this variable.
# Power Variables (Change If You Know What You're Doing)
#
# CAPTURE_INCLUDES - common capture stuff, currently it includes everything
#                    under the standard data directory
#
# Internal Variables (Don't Change Unless Absolutely Needed)
#
# ES_BASE_DIR - path where elasticsearch resides after installation - change
#                  CONTAINER_WORK_DIR instead
#
# ES_HOST_IP - IP address where this instance listens for connections
#
 ################################################################################
-->
<container class="com.datasynapse.fabric.container.ExecContainer">
    <property name="name" value="Elasticsearch Enabler"/>
    <property name="description" value="Enabler for Elasticsearch"/>
    <property name="version" value="1.0"/>
    <property name="distributionVersion" value="0.90.2"/>
    <property name="blocking" value="false"/>
    <property name="supportedDomainType" value="J2EE"/>
    
    <script class="com.datasynapse.fabric.common.script.Script">
        <property name="name" value="elasticsearch-enabler.py"/>
        <property name="language" value="jython"/>
        <property name="languageVersion" value="2.5"/>
    </script>
    
    <supportedFeature class="com.datasynapse.fabric.container.Feature">
        <property name="name" value="Capture Support"/>
        <property name="description" value="Support for capturing running Components"/>
        <property name="infoDescription" value="Specify if capture is enabled for this Component"/>
        <property name="infoClass" value="com.datasynapse.fabric.domain.featureinfo.CaptureFeatureInfo"/>
    </supportedFeature>
    
    <runtimecontexttemplate class="com.datasynapse.fabric.common.DefaultRuntimeContext">
     <variable class="com.datasynapse.fabric.common.RuntimeContextVariable">
            <property name="name" value="JDK_NAME"/>
            <property name="value" value="j2sdk"/>
            <property name="type" value="String"/>
            <property name="description" value="The name of the required JDK"/>
        </variable>
       <variable class="com.datasynapse.fabric.common.RuntimeContextVariable">
            <property name="name" value="CONTAINER_WORK_DIR"/>
            <property name="value" value="${ENGINE_WORK_DIR}/fabric"/>
            <property name="type" value="String"/>
            <property name="description" value="Define the root install of everything..."/>
        </variable>
        <variable class="com.datasynapse.fabric.common.RuntimeContextVariable">
            <property name="name" value="JDK_VERSION"/>
            <property name="value" value="1.7"/>
            <property name="type" value="String"/>
            <property name="description" value="The version of the required JDK"/>
        </variable>
    
        <variable class="com.datasynapse.fabric.common.RuntimeContextVariable">
            <property name="name" value="DELETE_RUNTIME_DIR_ON_SHUTDOWN"/>
            <property name="value" value="false"/>
        </variable>
        <variable class="com.datasynapse.fabric.common.RuntimeContextVariable">
            <property name="name" value="COPY_DEPENDENCIES_TO_WORK_DIRECTORY"/>
            <property name="value" value="true"/>
            <property name="type" value="String"/>
            <property name="description" value="Copy needed dependancies ${ENGINE_WORK_DIR}/fabric."/>
        </variable>
       	<variable class="com.datasynapse.fabric.common.RuntimeContextVariable">
            <property name="name" value="ElasticSearch_DISTRIBUTION_VERSION"/>
            <property name="value" value="0.92.2"/>
            <property name="description" value="ElasticSerach Distribution Version to be used"/>
        </variable>
        <variable class="com.datasynapse.fabric.common.RuntimeContextVariable">
            <property name="name" value="ES_BASE_DIR"/>
            <property name="value" value="${CONTAINER_WORK_DIR}/elasticsearch"/>
            <property name="description" value="Path where Elasticsearch resides after installation"/>
        </variable>
        <variable class="com.datasynapse.fabric.common.RuntimeContextVariable">
            <property name="name" value="MULTICAST_ENABLED"/>
            <property name="value" value="false"/>
            <property name="description" value="Set it to true if you have multicast networks, otherwise, leave to false, and the Enabler will set Unicast clustering"/>
        </variable>
        
        <variable class="com.datasynapse.fabric.common.RuntimeContextVariable">
            <property name="name" value="ES_DATA_DIR"/>
            <property name="value" value="${ES_BASE_DIR}/data"/>
            <property name="description" value="Path where data files are located"/>
        </variable>
        <variable class="com.datasynapse.fabric.common.RuntimeContextVariable">
            <property name="name" value="ES_LOG_DIR"/>
            <property name="value" value="${ES_BASE_DIR}/logs"/>
            <property name="description" value="Path where logs files are located"/>
        </variable>
        <variable class="com.datasynapse.fabric.common.RuntimeContextVariable">
            <property name="name" value="ES_TMP_DIR"/>
            <property name="value" value="${ES_BASE_DIR}/tmp"/>
            <property name="description" value="Path where temporary files are located"/>
        </variable>
        <variable class="com.datasynapse.fabric.common.RuntimeContextVariable">
            <property name="name" value="ES_CONF_DIR"/>
            <property name="value" value="${ES_BASE_DIR}/config"/>
            <property name="description" value="Path where configurations files are located"/>
        </variable>
        <variable class="com.datasynapse.fabric.common.RuntimeContextVariable">
            <property name="name" value="ES_PLUGINS_DIR"/>
            <property name="value" value="${ES_BASE_DIR}/plugins"/>
            <property name="description" value="Path where Plugs-ings files are located"/>
        </variable>                           
        <variable class="com.datasynapse.fabric.common.RuntimeContextVariable">
            <property name="name" value="ES_SHARDS_NUMBER"/>
            <property name="value" value="5"/>
            <property name="description" value="Set the number of shards (splits) of an index"/>
        </variable>
        <variable class="com.datasynapse.fabric.common.RuntimeContextVariable">
            <property name="name" value="ES_REPLICAS_NUMBER"/>
            <property name="value" value="2"/>
            <property name="description" value="Set the number of replicas (additional copies) of an index"/>
        </variable>
        <variable class="com.datasynapse.fabric.common.RuntimeContextVariable">
            <property name="name" value="CLUSTER_NAME"/>
            <property name="value" value="ElasticCluster"/>
            <property name="description" value="Set the number of replicas (additional copies) of an index"/>
        </variable>
        <variable class="com.datasynapse.fabric.common.RuntimeContextVariable">
            <property name="name" value="ES_HOST_IP"/>
            <property name="value" value="${LISTEN_ADDRESS}"/>
            <property name="export" value="true"/>
            <property name="description" value="Set binding addr for this instance"/>
        </variable>
        <variable class="com.datasynapse.fabric.common.RuntimeContextVariable">
            <property name="name" value="HTTP_PORT"/>
            <property name="value" value="18200"/>
            <property name="export" value="true"/>
            <property name="autoIncrementType" value="Numeric"/>
            <property name="description" value="HTTP port for this instance"/>
        </variable>
        <variable class="com.datasynapse.fabric.common.RuntimeContextVariable">
            <property name="name" value="ES_TCP_PORT"/>
            <property name="value" value="17200"/>
            <property name="export" value="true"/>
            <property name="autoIncrementType" value="Numeric"/>
        </variable>
        <variable class="com.datasynapse.fabric.common.RuntimeContextVariable">
            <property name="name" value="ES_MIN_MEM"/>
            <property name="value" value="2048m"/>
            <property name="export" value="true"/>
            <property name="type" value="Environment"/>
            <property name="description" value="MIN memory to be used by this instance"/>
        </variable>
        <variable class="com.datasynapse.fabric.common.RuntimeContextVariable">
            <property name="name" value="ES_MAX_MEM"/>
            <property name="value" value="2048m"/>
            <property name="export" value="true"/>
            <property name="type" value="Environment"/>
            <property name="description" value="MAX memory to be used by this instance"/>
        </variable>
        <variable class="com.datasynapse.fabric.common.RuntimeContextVariable">
            <property name="name" value="ES_JAVA_OPTS"/>
            <property name="value" value=""/>
            <property name="export" value="true"/>
            <property name="type" value="Environment"/>
            <property name="description" value="Pass any specific Java Options"/>
        </variable>                
        <variable class="com.datasynapse.fabric.common.RuntimeContextVariable">
            <property name="name" value="CAPTURE_INCLUDES"/>
            <property name="value" value="${ES_DATA_DIR}/*"/>
        </variable>
        <variable class="com.datasynapse.fabric.common.RuntimeContextVariable">
            <property name="name" value="CAPTURE_EXCLUDES"/>
            <property name="value" value=""/>
        </variable>
        <variable class="com.datasynapse.fabric.common.RuntimeContextVariable">
            <property name="name" value="ES_SOCKET"/>
            <property name="value" value="${ES_BASE_DIR}/es.sock"/>
            <property name="description" value="Socket that may be used by this instance"/>
        </variable>
    </runtimecontexttemplate>
   	<supportedFeature class="com.datasynapse.fabric.container.Feature">
        <property name="name" value="HTTP Support"/>
        <property name="description" value="Support for HTTP routing"/>
        <property name="infoDescription" value="Specify the protocols to report to the Broker for HTTP routing."/>
        <property name="infoClass" value="com.datasynapse.fabric.domain.featureinfo.HttpFeatureInfo"/>
    </supportedFeature>
    <supportedFeature class="com.datasynapse.fabric.container.Feature">
        <property name="name" value="Archive Management Support"/>
        <property name="description" value="Support for managing archives"/>
        <property name="infoClass" value="com.datasynapse.fabric.domain.featureinfo.ArchiveManagementFeatureInfo"/>
    </supportedFeature>
<statisticsProvider class="com.datasynapse.fabric.stats.provider.ContainerScriptStatisticsProvider">
	<supportedStatistic class="com.datasynapse.fabric.common.script.ScriptStatisticsMetadata">
		<property name="name" value="get:total"/>
		<property name="default" value="true"/>
		<property name="units" value="Gets"/>
		<property name="description" value="The Total number of gets against this ElasticSearch instance"/>
	</supportedStatistic>
	<supportedStatistic class="com.datasynapse.fabric.common.script.ScriptStatisticsMetadata">
		<property name="name" value="get:missing_time_in_millis"/>
		<property name="default" value="true"/>
		<property name="units" value="millis"/>
		<property name="description" value="Time consumed by missing queries in millis"/>
	</supportedStatistic>
	<supportedStatistic class="com.datasynapse.fabric.common.script.ScriptStatisticsMetadata">
		<property name="name" value="get:current"/>
		<property name="default" value="true"/>
		<property name="units" value="Gets"/>
		<property name="description" value="The Current number of gets against this ElasticSearch instance"/>
	</supportedStatistic>		
</statisticsProvider>	
</container>
